CREATE DATABASE IF NOT EXISTS projetoweb;
USE projetoweb;

-- usuarios (necessário para FK em trilhas_progresso)
CREATE TABLE IF NOT EXISTS usuarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(150) NOT NULL,
  email VARCHAR(200) UNIQUE,
  senha VARCHAR(255),
  criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- trilhas
CREATE TABLE IF NOT EXISTS trilhas (
  id VARCHAR(10) PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  descricao TEXT,
  ordem INT,
  nivel VARCHAR(50),
  data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- atividades das trilhas
CREATE TABLE IF NOT EXISTS trilhas_atividades (
  id VARCHAR(20) PRIMARY KEY,
  id_trilha VARCHAR(10),
  titulo VARCHAR(150) NOT NULL,
  descricao TEXT,
  tipo VARCHAR(50),
  pontuacao INT DEFAULT 0,
  `ordem` INT,
  FOREIGN KEY (id_trilha) REFERENCES trilhas(id)
) ENGINE=InnoDB;

-- progresso (FKs exigem tipos compatíveis e InnoDB)
CREATE TABLE IF NOT EXISTS trilhas_progresso (
  id INT AUTO_INCREMENT PRIMARY KEY,
  id_usuario INT,
  id_trilha VARCHAR(10),
  id_atividade VARCHAR(20),
  data_inicio DATETIME,
  data_conclusao DATETIME,
  pontuacao INT DEFAULT 0,
  status ENUM('em_andamento','concluido','pausado') DEFAULT 'em_andamento',
  FOREIGN KEY (id_usuario) REFERENCES usuarios(id),
  FOREIGN KEY (id_trilha) REFERENCES trilhas(id),
  FOREIGN KEY (id_atividade) REFERENCES trilhas_atividades(id)
) ENGINE=InnoDB;

-- lições (opcional)
CREATE TABLE IF NOT EXISTS licoes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  titulo VARCHAR(255) NOT NULL,
  descricao TEXT,
  tipo ENUM('texto','audio','video','imagem') DEFAULT 'texto',
  arquivo VARCHAR(255),
  nivel VARCHAR(50),
  criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

select * from trilhas_atividades;
INSERT INTO trilhas_atividades (id_trilha, titulo, descricao, tipo, pontuacao, ordem)
VALUES (1, 'Exercício de Vocabulário', 'Associe as palavras em inglês às suas traduções em português.', 'quiz', 10, 1);

INSERT INTO licoes (id, titulo, descricao, tipo, arquivo, nivel, criado_em)
VALUES (1, 'Atividade de Escrita', 'Escreva um parágrafo sobre sua rotina diária.', 'PDF', 'atividade1.pdf', 'Básico', '2023-10-27 15:30:00');

INSERT INTO trilhas (id, nome, descricao, ordem, nivel, data_criacao)
VALUES (1, 'Trilha de Habilidades Básicas', 'Descrição da trilha de habilidades iniciantes para novos usuários.', 1, 'Iniciante', '2023-10-27 10:00:00');
